<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>A Contagem da Rosa ‚Äî Cinem√°tica</title>
<meta name="color-scheme" content="dark" />

<style>
/* ============================================================
   TEMA CINEM√ÅTICO ‚Äî LUXO M√çSTICO
   Aurora leve + estrelas + neve + brilho suave
   Totalmente otimizado para iPhone 15 Pro Max
============================================================ */

:root{
  --bg-deep:#06050a;
  --nebula-1: rgba(91,35,96,0.12);
  --nebula-2: rgba(134,54,131,0.08);
  --accent:#d8b3f1;
  --accent-2:#f6d7b1;
  --muted:#f0e9f6;
  --card-bg: rgba(255,255,255,0.035);
  --glass: rgba(255,255,255,0.05);
}

*{ box-sizing:border-box; }

html,body{
  height:100%; margin:0;
  font-family:Inter,system-ui,-apple-system,Roboto,Helvetica,Arial;
  color:var(--muted);
  background:
    radial-gradient(1200px 700px at 12% 10%, var(--nebula-1), transparent 22%),
    radial-gradient(900px 500px at 90% 75%, var(--nebula-2), transparent 18%),
    linear-gradient(180deg, var(--bg-deep) 0%, #0b0b12 100%);
  -webkit-font-smoothing:antialiased;
  -webkit-text-size-adjust:100%;
  overscroll-behavior:none;
}

body{
  padding-bottom:env(safe-area-inset-bottom);
  -webkit-tap-highlight-color: transparent;
}

/* ============================================================
   HEADER
============================================================ */

.wrap{
  width:100%;
  max-width:1100px;
  margin:0 auto;
  padding:24px 18px 120px;
  position:relative;
  z-index:10;
}

header{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
}

.title h1{
  margin:0; font-size:22px; font-weight:600;
}

.subtitle{
  margin-top:6px; font-size:13px; opacity:0.78;
}

/* ============================================================
   CONTROLES ‚Äî Contador e M√∫sica
============================================================ */

.controls{
  display:flex; gap:12px; align-items:center;
}

.count{
  background:var(--glass);
  padding:10px 12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.04);
  font-size:13px;
  backdrop-filter:blur(4px);
}

.count .num{
  font-weight:700; color:var(--accent);
  margin-top:4px;
}

#startMusic{
  padding:10px 14px;
  border-radius:12px;
  background:linear-gradient(180deg,var(--accent),#a77bb7);
  border:0; color:#080206;
  font-weight:700; cursor:pointer;
}
#startMusic.playing {
  background:linear-gradient(180deg, #a77bb7, var(--accent));
}


/* ============================================================
   GRID FANT√ÅSTICO / ANIMA√á√ÉO
============================================================ */

main.grid{
  margin-top:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(110px,1fr));
  gap:14px;
  touch-action:manipulation;
}

.day{
  aspect-ratio:1;
  border-radius:14px;
  background:linear-gradient(180deg,var(--card-bg),rgba(255,255,255,0.02));
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  cursor:pointer; position:relative;
  overflow:visible;
  box-shadow:0 8px 28px rgba(0,0,0,0.55);
  transform:translateY(22px) scale(.94);
  opacity:0;
}

/* anima√ß√£o de entrada estagiada */
.day.enter{
  animation:cardIn .55s cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes cardIn{
  0%{ opacity:0; transform:translateY(28px) scale(.94); }
  100%{ opacity:1; transform:none; }
}

.circle{
  width:60px; height:60px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:linear-gradient(180deg, rgba(20,12,30,0.95), rgba(28,40,64,0.96));
  border:1px solid rgba(255,255,255,0.05);
  font-weight:700; font-size:18px;
}

.label{
  margin-top:8px; font-size:12px; opacity:0.92;
  text-align:center; padding:0 6px;
}

/* locked visual */
.day.locked{
  filter:grayscale(45%) brightness(0.60);
  opacity:0.40;
  transform:scale(0.95);
  box-shadow:0 4px 12px rgba(0,0,0,0.55);
}

/* checked */
.day.checked{
  box-shadow:0 14px 40px rgba(212,160,255,0.14);
}

.day .check{
  position:absolute; right:8px; top:8px;
  width:28px; height:28px;
  border-radius:8px;
  display:flex; align-items:center; justify-content:center;
  background:var(--accent-2);
  color:#000; font-weight:700;
  transform:scale(0);
  transition:transform .22s cubic-bezier(.2,.9,.2,1);
}

.day.checked .check{ transform:scale(1); }

/* hover (desktop only) */
@media (hover:hover){
  .day:hover{
    transform:translateY(-6px);
    box-shadow:0 22px 60px rgba(0,0,0,0.65);
  }
}

/* ============================================================
   MODAL CINEM√ÅTICO ‚Äî vidro + glow
============================================================ */

.modalBack{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  background:linear-gradient(rgba(2,3,6,0.55),rgba(2,3,6,0.85));
  z-index:220; padding:18px;
}

.modal{
  width:100%; max-width:760px;
  border-radius:16px;
  padding:22px 20px;
  background:linear-gradient(180deg, rgba(10,8,18,0.86), rgba(20,12,30,0.97));
  border:1px solid rgba(255,255,255,0.04);
  backdrop-filter:blur(10px);
  box-shadow:0 28px 80px rgba(0,0,0,0.70);
  transform:translateY(12px) scale(.96);
  opacity:0;
}

.modal.show{
  animation:modalIn .36s cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes modalIn{
  to{ opacity:1; transform:none; }
}

.modal h2{
  margin:0 0 10px 0;
  color:var(--accent);
}

.modal p{
  line-height:1.65;
  font-size:15px;
  white-space:pre-line;   /* ISSO AQUI √â O QUE MELHORA TUDO */
}


/* senha */
.passwordBox input{
  width:100%;
  padding:12px;
  border-radius:10px;
  background:rgba(255,255,255,0.05);
  border:0; color:var(--muted);
}

/* dica */
.hintBox{
  background:rgba(255,255,255,0.04);
  border-radius:10px;
  padding:12px;
  min-height:60px;
}

/* bot√µes modal */
.btnRow{
  margin-top:14px;
  display:flex;
  gap:12px;
  justify-content:flex-end;
}

.btn{
  padding:10px 14px;
  border-radius:10px;
  border:0; cursor:pointer;
}

.btn.primary{
  background:linear-gradient(180deg,var(--accent),#b58ad8);
  color:#09040d; font-weight:700;
}

.btn.ghost{
  background:transparent;
  border:1px solid rgba(255,255,255,0.06);
  color:var(--muted);
}

/* toast */
.toast{
  position:fixed;
  left:50%; transform:translateX(-50%) translateY(20px);
  bottom:28px;
  padding:10px 14px;
  border-radius:12px;
  background:rgba(0,0,0,0.65);
  opacity:0;
  color:var(--muted);
  transition:all .22s;
  z-index:300;
}
.toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* cursor de digita√ß√£o (typing effect) */
.type-cursor{
  display:inline-block; width:7px; height:18px;
  background:var(--accent);
  margin-left:6px;
  animation:blink 1s steps(2) infinite;
}
@keyframes blink{ 50%{opacity:0;} }

/* responsivo */
@media (max-width:720px){
  main.grid{ grid-template-columns:repeat(3,1fr); gap:10px; }
  .circle{ width:52px; height:52px; font-size:16px; }
  .modal{ padding:18px; }
}

</style>
</head>
<body>

<!-- ============================================================
     CANVAS ‚Äî Aurora + Estrelas + Neve
============================================================ -->

<canvas id="aurora" style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:3"></canvas>
<canvas id="stars"  style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:2"></canvas>
<canvas id="snow"   style="position:fixed;left:0;top:0;width:100%;height:100%;pointer-events:none;z-index:4"></canvas>


<!-- ============================================================
     MAIN CONTENT
============================================================ -->

<div class="wrap" role="main">

  <header>
    <div class="title">
      <h1>üåô A Contagem da Rosa</h1>
      <div class="subtitle">
        H√° magias que n√£o precisam de feiti√ßos ‚Äî s√≥ do tempo certo para florescer.
      </div>
    </div>

    <div class="controls" aria-hidden="false">
      <div class="count" aria-live="polite">
        <div style="font-size:12px;opacity:0.72">Contagem at√© 17 de Dezembro</div>
        <div class="num" id="cdText">-- dias --</div>
      </div>

      <button id="startMusic" aria-label="Tocar m√∫sica">‚ñ∂ M√∫sica</button>
    </div>
  </header>


  <!-- Calend√°rio -->
  <main id="grid" class="grid" aria-label="Calend√°rio do advento"></main>

  <div style="margin-top:18px;font-size:14px;opacity:0.65;">
    Oi, meu bem...
  </div>

</div>


<!-- ============================================================
     MODAL
============================================================ -->

<div class="modalBack" id="modalBack" aria-hidden="true">
  <div class="modal" id="modal" role="dialog" aria-modal="true">

    <button id="closeModal"
      style="float:right;background:none;border:0;color:var(--muted);font-size:20px;cursor:pointer">‚úï</button>

    <h2 id="modalTitle">Dia</h2>

    <div id="modalBody">
      <p id="modalText">carregando...</p>
    </div>
    <!-- CAPA DO √ÅLBUM -->
<div id="albumBox" style="
    display:none;
    margin-top:18px;
    text-align:center;
">
  <img id="albumArt" 
       src="" 
       alt="Capa do √°lbum"
       style="
         width:150px;
         height:150px;
         object-fit:cover;
         border-radius:16px;
         box-shadow:0 6px 18px rgba(0,0,0,0.45);
         opacity:0;
         transition:opacity .45s ease;
       ">
  <div id="albumTitle" style="margin-top:10px;font-size:14px;opacity:0.78;"></div>
</div>

<div id="extraMusicBox" style="display:none; margin-top:16px;">
  <button id="playAltMusic" 
          class="btn ghost"
          style="width:100%; text-align:center;">
    ‚ñ∂ Tocar m√∫sica deste dia
  </button>
</div>
<div style="display:flex; gap:10px; margin-top:10px;">
  <button id="prevTrack" class="btn ghost" style="flex:1; display:none;">‚èÆ M√∫sica anterior</button>
  <button id="nextTrack" class="btn ghost" style="flex:1; display:none;">‚è≠ Pr√≥xima m√∫sica</button>
</div>

<button id="backToMainMusic"
        class="btn ghost"
        style="width:100%; text-align:center; margin-top:10px; display:none;">
  ‚è™ Voltar para a m√∫sica principal
</button>

    <div class="passwordBox" id="passwordBox">
      <label style="display:block;margin-bottom:6px;opacity:0.8">Senha do dia</label>
      <input id="passwordInput" type="password" placeholder="Digite a senha"
             aria-label="Senha do dia" inputmode="text" />
    </div>

    <div style="height:10px"></div>

    <div id="hintContainer">
      <label style="display:block;margin-bottom:6px;opacity:0.8">Dica</label>
      <div class="hintBox" id="hintBox" aria-live="polite"></div>
    </div>

    <div class="btnRow">
      <button class="btn ghost" id="btnClose">Fechar</button>
      <button class="btn primary" id="btnConfirm">Confirmar</button>
    </div>

  </div>
</div>


<!-- ============================================================
     TOAST
============================================================ -->

<div class="toast" id="toast">‚úî Senha correta</div>


<!-- ============================================================
     AUDIO
============================================================ -->

<audio id="bgMusic" loop preload="auto"
  src="body-on-fire.mp3"></audio>
<script>
/* ============================================================
   M√öSICA ‚Äî Play com desbloqueio do iPhone + Fade-in suave
============================================================ */

const bgMusic = document.getElementById("bgMusic");
const startBtn = document.getElementById("startMusic");

let musicStarted = false;

startBtn.addEventListener("click", async () => {
  try {
    if (!musicStarted) {
      bgMusic.volume = 0.15; // volume inicial baixo
      await bgMusic.play();

      musicStarted = true;
      startBtn.classList.add("playing");
      startBtn.textContent = "üéµ Tocando";

      // fade-in at√© volume confort√°vel
      let vol = 0.15;
      const fade = setInterval(() => {
        vol += 0.015;
        if (vol >= 0.55) {  // limite final do fade-in
          bgMusic.volume = 0.55;
          clearInterval(fade);
        } else {
          bgMusic.volume = vol;
        }
      }, 60);

    } else {
      // Toggle para pausar
      bgMusic.pause();
      musicStarted = false;
      startBtn.classList.remove("playing");
      startBtn.textContent = "‚ñ∂ M√∫sica";
    }

  } catch (err) {
    alert("O navegador bloqueou o √°udio. Ative o som manualmente e tente de novo.");
  }
});


/* ============================================================
   DIAS ‚Äî Simples de editar
   Apenas ajuste text / password / hint
============================================================ */
const days = [
{
  "index": 1,
  "date": "2025-11-17",
  "label": "17/11",

  "text_before": "Toda hist√≥ria tem um ponto onde o destino respira mais fundo.\nO nosso‚Ä¶ come√ßou com um som simples.\nUma coisa que atravessou o sil√™ncio.\nAlgo que despertou tudo.\n\nSe voc√™ lembrar desse primeiro gesto, deste primeiro ‚Äúchamado‚Äù, a porta se abre.",

  "password": "liga√ß√£o",

  "hint": "Pense na a√ß√£o que come√ßou tudo.",

  "text_after": "17 de novembro.\n\nExiste um tipo de destino que n√£o desce do c√©u nem se anuncia em grandezas.\nEle simplesmente chama. √Äs vezes tarde da noite. √Äs vezes com uma voz que voc√™ nunca ouviu antes ‚Äî e que, ainda assim, parece familiar.\n\nNaquela noite, voc√™ me ligou. E algo em mim‚Ä¶ acordou de verdade.\n\nFoi o instante em que o mundo - o meu mundo ‚Äî deixou de ser cinza...\nFoi quando o sil√™ncio ganhou forma,\nquando o escuro deu passagem,\nquando eu soube, sem entender por qu√™,\nque aquela luz era diferente.\n\n‚ÄúObrigado por ter me ligado...‚Äù\n‚ÄúObrigada por me atender e n√£o ir dormir...‚Äù\n\nEu nunca esqueci.\nNunca vou esquecer.\n\nVoc√™ foi o come√ßo de tudo."
},

  {
  "index": 2,
  "date": "2025-11-18",
  "label": "18/11",

  "text_before": "Ontem o universo trope√ßou ‚Äî e me arrependo.\nAlgumas coisas come√ßam assim: fora do ritmo, fora da hora.\nHoje, por√©m, ele se ajusta.\n\nPorque 18 nunca foi s√≥ um n√∫mero.\nFoi uma porta, um marco, um jeito do tempo dizer: ‚Äúaqui, algo muda‚Äù.\n\nPara abrir este dia, voc√™ precisa lembrar das tr√™s marcas que sempre foram nossas:\no dia que virou ritual,\no m√™s que virou mem√≥ria,\ne o segredo silencioso que sempre nos acompanhou.\n\nA combina√ß√£o que s√≥ existe quando √© voc√™ e eu‚Ä¶ abre o caminho.",

  "password": "1805",

  "hint": "Dia. M√™s. N√≥s.",

  "text_after": "18 sempre foi um lugar, n√£o um n√∫mero.\nUm ponto onde tudo se realinha ‚Äî mesmo quando parecia fora do eixo.\n\n√â por isso que hoje importa tanto.\nPorque hoje eu quis fazer do 18 aquilo que ele sempre foi pra gente:\num come√ßo limpo, intencional, cuidado.\n\nE quando voc√™ digitou 1805, n√£o foi s√≥ uma senha.\nFoi uma lembran√ßa ‚Äî nossa forma discreta de dizer que sabemos quem somos, e de onde come√ßamos.\n\nO 17 trope√ßou.\nO 18 acerta o passo.\n\nE agora sim: come√ßa o que realmente quero entregar pra voc√™.\nCom calma.\nCom brilho.\nCom presen√ßa.\n\nPressione play.\nO resto, eu te mostro no caminho."
},
{
  "index": 3,
  "date": "2025-11-19",
  "label": "19/11",

  "text_before": "35 de 72\n10¬™ frase\nPalavra 4",

  "password": "mine",

  "hint": "Grey ‚Äî Cinza",

  "text_after": "Come√ßou a perceber como esse lugar funciona, n√©?\nAqui dentro, cada dia tem um ritmo: alguns v√£o exigir calma, outros aten√ß√£o, outros s√≥‚Ä¶ sentir.\n\nQuero te mostrar todas as camadas da sua intensidade\nCada pequeno enigma, cada detalhe, cada escolha‚Ä¶ √© uma parte do que eu sinto por voc√™.\n\nE, princesa‚Ä¶\neu amo voc√™ de um jeito que nenhum c√≥digo, palavra ou gesto consegue explicar por completo."
},

  {"index":4,"date":"2025-11-20","label":"20/11","text":"Cada gesto teu √© uma estrela.","password":"p4","hint":"Luz em detalhes."},
  {"index":5,"date":"2025-11-21","label":"21/11","text":"√Äs vezes o amor n√£o grita ‚Äî ele sussurra.","password":"p5","hint":"O sil√™ncio fala."},
  {"index":6,"date":"2025-11-22","label":"22/11","text":"H√° lugares que s√≥ o amor conhece.","password":"p6","hint":"Mem√≥rias escondidas."},
  {"index":7,"date":"2025-11-23","label":"23/11","text":"Sete dias, sete luzes.","password":"p7","hint":"O n√∫mero sete."},
  {"index":8,"date":"2025-11-24","label":"24/11","text":"Recordei uma conversa nossa.","password":"p8","hint":"Palavras em chuva."},
  {"index":9,"date":"2025-11-25","label":"25/11","text":"H√° um diamante oculto em cada escolha.","password":"p9","hint":"Escolha com carinho."},
  {"index":10,"date":"2025-11-26","label":"26/11","text":"Lembra do nosso primeiro riso alto?","password":"p10","hint":"Ria outra vez."},
  {"index":11,"date":"2025-11-27","label":"27/11","text":"As estrelas guardam lembran√ßas.","password":"p11","hint":"Olhe pra cima."},
  {"index":12,"date":"2025-11-28","label":"28/11","text":"Penso nas fases da lua como promessas.","password":"p12","hint":"Fases e promessas."},
  {"index":13,"date":"2025-11-29","label":"29/11","text":"Uma playlist antiga toca ao fundo.","password":"p13","hint":"Uma m√∫sica antiga."},
  {"index":14,"date":"2025-11-30","label":"30/11","text":"Desenhar o teu reflexo.","password":"p14","hint":"Jardins de certezas."},
  {"index":15,"date":"2025-12-01","label":"01/12","text":"Uma porta pequena em mim.","password":"p15","hint":"Portas pequenas."},
  {"index":16,"date":"2025-12-02","label":"02/12","text":"Alice entrou em um pa√≠s de maravilhas.","password":"p16","hint":"Ch√° e caminhos."},
  {"index":17,"date":"2025-12-03","label":"03/12","text":"Hoje escrevo uma carta curta: obrigada.","password":"p17","hint":"Obrigado."},
  {"index":18,"date":"2025-12-04","label":"04/12","text":"Uma foto rasgada, uma polaroid amarelada.","password":"p18","hint":"Fotos antigas."},
  {"index":19,"date":"2025-12-05","label":"05/12","text":"Sinto o cheiro de vinho e lasanha.","password":"p19","hint":"Cheiros que lembram."},
  {"index":20,"date":"2025-12-06","label":"06/12","text":"No mapa que tra√ßo toda noite.","password":"p20","hint":"Curvas no mapa."},
  {"index":21,"date":"2025-12-07","label":"07/12","text":"O n√∫mero sete nos sorri.","password":"p21","hint":"Sete cores."},
  {"index":22,"date":"2025-12-08","label":"08/12","text":"Se o amor tivesse uma textura.","password":"p22","hint":"Veludo ao entardecer."},
  {"index":23,"date":"2025-12-09","label":"09/12","text":"Luz de vela, duas ta√ßas.","password":"p23","hint":"Brinde breve."},
  {"index":24,"date":"2025-12-10","label":"10/12","text":"Um pequeno enigma: feche os olhos.","password":"p24","hint":"Conte respira√ß√µes."},
  {"index":25,"date":"2025-12-11","label":"11/12","text":"Na dan√ßa das horas encontrei compasso.","password":"p25","hint":"Ritmo lento."},
  {"index":26,"date":"2025-12-12","label":"12/12","text":"H√° um pingente que carrego em mem√≥ria.","password":"p26","hint":"S√≠mbolos antigos."},
  {"index":27,"date":"2025-12-13","label":"13/12","text":"As fases da lua me lembram de ti.","password":"p27","hint":"Fases: inteira/tra√ßo."},
  {"index":28,"date":"2025-12-14","label":"14/12","text":"Escrevo-te como quem fala ao vento.","password":"p28","hint":"Palavras ao vento."},
  {"index":29,"date":"2025-12-15","label":"15/12","text":"A reta final aproxima-se.","password":"p29","hint":"Cores intensas."},
  {"index":30,"date":"2025-12-16","label":"16/12","text":"Amanhecer de v√©spera: preparei surpresas.","password":"p30","hint":"Sete surpresas."},
  {"index":31,"date":"2025-12-17","label":"17/12","text":"Hoje o tempo se curva. Feliz anivers√°rio, Rosa.","password":"vday","hint":"A data √© a chave."}
];


/* ============================================================
   HELPERS
============================================================ */
function parseLocalDateYMD(ymd){
  const [y,m,d] = ymd.split('-').map(Number);
  return new Date(y, m-1, d, 0,0,0,0);
}

const STORAGE_KEY = "rosa_unlocked_cinematic_v2";
let unlockedSet = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"));


/* ============================================================
   GRID ‚Äî Render + anima√ß√£o stagger
============================================================ */
const grid = document.getElementById("grid");

function createGrid(){
  grid.innerHTML = "";

  days.forEach((d,i)=>{
    const el = document.createElement("div");

    const today = new Date(); today.setHours(0,0,0,0);
    const dayDate = parseLocalDateYMD(d.date);

    const unlockedByTime = today >= dayDate;
    const alreadyUnlocked = unlockedSet.has(String(i));

    el.className = unlockedByTime ? "day unlocked" : "day locked";
    if(alreadyUnlocked) el.classList.add("checked");

    el.dataset.index = i;

    el.innerHTML = `
      <div class="circle">${d.index}</div>
      <div class="label">${d.label}</div>
      <div class="check">‚úì</div>
    `;

    grid.appendChild(el);

    // delay de entrada (efeito cascata)
    setTimeout(()=> el.classList.add("enter"), i * 40);
  });
}

createGrid();


/* ============================================================
   COUNTDOWN
============================================================ */
const cdText = document.getElementById("cdText");
const target = parseLocalDateYMD("2025-12-17");

function updateCountdown(){
  const now = new Date();
  let diff = target - now;
  if(diff < 0) diff = 0;

  const daysLeft = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
  const mins = Math.floor((diff % (1000*60*60)) / (1000*60));

  cdText.textContent = `${daysLeft}d ${hours}h ${mins}m`;
}

updateCountdown();
setInterval(updateCountdown, 60000);


/* ============================================================
   MODAL ELEMENTS (refer√™ncias)
============================================================ */

const modalBack = document.getElementById("modalBack");
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalText  = document.getElementById("modalText");

// M√∫sica adicional por dia
const extraMusicBox = document.getElementById("extraMusicBox");
const playAltMusicBtn = document.getElementById("playAltMusic");
const backToMainMusicBtn = document.getElementById("backToMainMusic");
const MAIN_MUSIC = "body-on-fire.mp3";

// helper: retorna lista de m√∫sicas para o dia (usando days[i].index)
function getDayMusicByArrayIndex(arrayIndex) {
  if (arrayIndex === null || arrayIndex === undefined) return null;
  const dayObj = days[arrayIndex];
  if (!dayObj) return null;
  const key = dayObj.index; // esse √© o "index" que voc√™ colocou no objeto (1,2,3...)
  return dayExtraMusic[key] || null;
}

// mapa de m√∫sicas extras por dia
const dayExtraMusic = {
  3: [
    {
      src: "sleep-token-mine.mp3",
      title: "Sleep Token ‚Äî Mine",
      cover: "mine-cover.jpg"
    },
    {
      src: "body-on-fire.mp3",
      title: "SLAVES ‚Äî Body On Fire",
      cover: "body-on-fire-cover.jpg"
    }
  ]
};




const passwordBox = document.getElementById("passwordBox");
const passwordInput = document.getElementById("passwordInput");

const hintContainer = document.getElementById("hintContainer");
const hintBox = document.getElementById("hintBox");

const btnConfirm = document.getElementById("btnConfirm");
const btnClose = document.getElementById("btnClose");
const closeModalBtn = document.getElementById("closeModal");

const toast = document.getElementById("toast");

let currentIndex = null;
let typeTimer = null;

/* ============================================================
   Typewriter effect
============================================================ */
function typeText(el, text, speed=22, done){
  if(typeTimer){ clearTimeout(typeTimer); typeTimer=null; }
  el.textContent = "";
  let i=0;

  function step(){
    if(i < text.length){
      el.textContent += text[i++];
      typeTimer = setTimeout(step, speed);
    } else if(done){
      done();
    }
  }
  step();
}
/* ============================================================
   MODAL ‚Äî Abrir
============================================================ */
function showModal(){
  modalBack.style.display = "flex";
  modalBack.setAttribute("aria-hidden", "false");
  modal.classList.add("show");
}

function closeModal(){
  modalBack.style.display = "none";
  modalBack.setAttribute("aria-hidden", "true");
  modal.classList.remove("show");

  currentIndex = null;
  if(typeTimer){ clearTimeout(typeTimer); typeTimer=null; }

  // restaurar elementos para pr√≥ximo acesso
  passwordBox.style.display = "block";
  hintContainer.style.display = "block";
  btnConfirm.style.display = "inline-block";
}

/* ============================================================
   MODAL ‚Äî Conte√∫do inicial
============================================================ */
function openModal(i){
  currentIndex = i;
  const d = days[i];

  const alreadyUnlocked = unlockedSet.has(String(i));

// -------- dia j√° desbloqueado --------
if (alreadyUnlocked) {
  modalTitle.textContent = `${d.label} ‚Äî Desbloqueado üíó`;

  // sempre mostrar o texto final ap√≥s desbloquear
  const reveal = d.text_after || d.text || d.text_before || "Conte√∫do desbloqueado.";
  modalText.textContent = reveal;

  passwordBox.style.display = "none";
  hintContainer.style.display = "none";
  btnConfirm.style.display = "none";

  showModal();
  return;
}


  // -------- dia ainda bloqueado (mas j√° no dia permitido) --------
  modalTitle.textContent = d.label;

  // efeito digitando
typeText(modalText, d.text_before || d.text, 22);


  passwordInput.value = "";
  hintBox.textContent = d.hint || "";

// N√ÉO mostrar m√∫sica extra antes do desbloqueio
extraMusicBox.style.display = "none";
document.getElementById("prevTrack").style.display = "none";
document.getElementById("nextTrack").style.display = "none";
document.getElementById("albumBox").style.display = "none";
document.getElementById("albumArt").style.opacity = 0;
document.getElementById("albumTitle").textContent = "";



backToMainMusicBtn.style.display = "none";
playAltMusicBtn.textContent = "‚ñ∂ Tocar m√∫sica deste dia";



  showModal();
  setTimeout(() => passwordInput.focus(), 200);
}

let currentTrack = 0;  

function playTrack(list, index) {
  if (!list || !list[index]) return;

  const track = list[index];

  // troca m√∫sica
  bgMusic.pause();
  bgMusic.src = track.src;
  bgMusic.volume = 0;
  bgMusic.play();

  // fade-in
  let v = 0;
  const fade = setInterval(() => {
    v += 0.03;
    if (v >= 0.55) {
      bgMusic.volume = 0.55;
      clearInterval(fade);
    } else {
      bgMusic.volume = v;
    }
  }, 60);

  // mostra capa
  const albumBox = document.getElementById("albumBox");
  const albumArt = document.getElementById("albumArt");
  const albumTitle = document.getElementById("albumTitle");

  albumBox.style.display = "block";

  albumArt.style.opacity = 0;
  albumArt.src = track.cover;

  requestAnimationFrame(() => {
    albumArt.style.opacity = 1;
  });

  albumTitle.textContent = track.title;

  playAltMusicBtn.textContent = "üéµ Tocando trilha";
}

// BOT√ÉO ‚Äî tocar m√∫sica
playAltMusicBtn.addEventListener("click", () => {
  const list = getDayMusicByArrayIndex(currentIndex);
  if (!list) return;

  currentTrack = 0;
  playTrack(list, currentTrack);

  backToMainMusicBtn.style.display = "block";
});


// BOT√ÉO ‚Äî voltar m√∫sica principal
backToMainMusicBtn.addEventListener("click", () => {
  bgMusic.pause();
  bgMusic.src = MAIN_MUSIC;
  bgMusic.volume = 0;
  bgMusic.play();

  let v = 0;
  const fade = setInterval(() => {
    v += 0.03;
    if (v >= 0.55) {
      bgMusic.volume = 0.55;
      clearInterval(fade);
    } else {
      bgMusic.volume = v;
    }
  }, 60);

  playAltMusicBtn.textContent = "‚ñ∂ Tocar trilha deste dia";
  backToMainMusicBtn.style.display = "none";
});

// BOT√ÉO ‚Äî pr√≥xima m√∫sica
document.getElementById("nextTrack").addEventListener("click", () => {
  const list = getDayMusicByArrayIndex(currentIndex);
  if (!list) return;

  currentTrack = (currentTrack + 1) % list.length;
  playTrack(list, currentTrack);
});

// BOT√ÉO ‚Äî m√∫sica anterior
document.getElementById("prevTrack").addEventListener("click", () => {
  const list = getDayMusicByArrayIndex(currentIndex);
  if (!list) return;

  currentTrack = (currentTrack - 1 + list.length) % list.length;
  playTrack(list, currentTrack);
});


backToMainMusicBtn.addEventListener("click", () => {
  bgMusic.pause();
  bgMusic.src = MAIN_MUSIC;
  bgMusic.volume = 0;
  bgMusic.play();

  let vol = 0;
  const fade = setInterval(() => {
    vol += 0.03;
    if (vol >= 0.55) {
      bgMusic.volume = 0.55;
      clearInterval(fade);
    } else {
      bgMusic.volume = vol;
    }
  }, 60);

  backToMainMusicBtn.style.display = "none";
  playAltMusicBtn.textContent = "‚ñ∂ Tocar m√∫sica deste dia";
});

/* ============================================================
   MODAL ‚Äî Confirmar senha
============================================================ */
btnConfirm.addEventListener("click", () => {
  if(currentIndex === null) return;

  const d = days[currentIndex];
  const typed = (passwordInput.value || "").trim().toLowerCase();

  if(!d.password){
    showToast("‚úî Sem senha ‚Äî liberado");
    unlockDay(currentIndex);
    return;
  }

  if(typed === d.password.toLowerCase()){
    unlockDay(currentIndex);
  } else {
    showToast("‚úñ Senha incorreta");
    passwordInput.focus();
  }
});


/* ============================================================
   DESBLOQUEAR DIA
============================================================ */
function unlockDay(i){
  const d = days[i];
  const dayEl = document.querySelector(`.day[data-index="${i}"]`);

  if(dayEl){
    dayEl.classList.add("checked");
  }

  unlockedSet.add(String(i));
  localStorage.setItem(STORAGE_KEY, JSON.stringify([...unlockedSet]));

  // atualizar modal
  modalTitle.textContent = `${d.label} ‚Äî Desbloqueado üíó`;
  const reveal = d.text_after || d.hint || d.text_before;
  modalText.textContent = reveal;
// Se o dia tiver m√∫sicas extras, MOSTRAR agora que desbloqueou
const list = getDayMusicByArrayIndex(i);
if (list) {
  extraMusicBox.style.display = "block";
  document.getElementById("prevTrack").style.display = "block";
  document.getElementById("nextTrack").style.display = "block";

  const albumBox = document.getElementById("albumBox");
  const albumArt = document.getElementById("albumArt");
  const albumTitle = document.getElementById("albumTitle");

  albumBox.style.display = "block";
  albumArt.style.opacity = 0;

  if (list[0]) {
    albumArt.src = list[0].cover;
    albumTitle.textContent = list[0].title;
    requestAnimationFrame(() => {
      albumArt.style.opacity = 1;
    });
  } else {
    albumTitle.textContent = "";
  }
}


  passwordBox.style.display = "none";
  hintContainer.style.display = "none";
  btnConfirm.style.display = "none";

  showToast("‚úî Senha correta");

  // efeito de part√≠culas
  spawnSparklesAt(dayEl);
}


/* ============================================================
   TOAST
============================================================ */
function showToast(msg="‚úî"){
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 1600);
}


/* ============================================================
   GRID ‚Äî Clique
============================================================ */
grid.addEventListener("click", ev => {
  const dayEl = ev.target.closest(".day");
  if(!dayEl) return;

  const i = Number(dayEl.dataset.index);
  if(isNaN(i)) return;

  const d = days[i];
  const dayDate = parseLocalDateYMD(d.date);

  const today = new Date();
  today.setHours(0,0,0,0);

  // ainda n√£o chegou a data
  if(today < dayDate){
    modalTitle.textContent = "Ainda trancado";
    modalText.textContent = "O tempo ainda n√£o permite ver este dia. Espere um pouco mais, meu bem.";

    passwordBox.style.display = "none";
    hintContainer.style.display = "none";
    btnConfirm.style.display = "none";

    showModal();
    return;
  }

  // pode abrir normalmente
  openModal(i);
});


/* ============================================================
   Fechar modal
============================================================ */
closeModalBtn.addEventListener("click", closeModal);
btnClose.addEventListener("click", closeModal);
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape") closeModal();
});


/* ============================================================
   Sparkles ‚Äî Efeito ao desbloquear
============================================================ */
function spawnSparklesAt(el){
  if(!el) return;

  const rect = el.getBoundingClientRect();
  const cx = rect.left + rect.width/2;
  const cy = rect.top + rect.height/2;

  const canvas = document.createElement("canvas");
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  canvas.style.position = "fixed";
  canvas.style.left = "0";
  canvas.style.top = "0";
  canvas.style.pointerEvents = "none";
  canvas.style.zIndex = "9999";

  document.body.appendChild(canvas);

  const ctx = canvas.getContext("2d");

  const particles = [];
  const count = 24;

  for(let i=0;i<count;i++){
    particles.push({
      x: cx,
      y: cy,
      vx: (Math.random()-0.5)*3,
      vy: (Math.random()-0.8)*3,
      r: Math.random()*2+1,
      life: Math.random()*40 + 20,
      color: Math.random()>0.5
        ? "rgba(207,163,224,1)"
        : "rgba(246,215,166,1)"
    });
  }

  let frame=0;

  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(const p of particles){
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.04;
      p.life--;

      const opacity = Math.max(0, p.life / 60);

      ctx.beginPath();
      ctx.fillStyle = p.color.replace("1)", `${opacity})`);
      ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
      ctx.fill();
    }

    frame++;

    if(frame < 80){
      requestAnimationFrame(loop);
    } else {
      canvas.remove();
    }
  }
  loop();
}
</script>
<script>
/* ============================================================
   CANVAS ‚Äî Aurora, Estrelas e Neve (final do script)
============================================================ */

const starsCanvas = document.getElementById("stars");
const auroraCanvas = document.getElementById("aurora");
const snowCanvas   = document.getElementById("snow");

const sctx = starsCanvas.getContext("2d");
const actx = auroraCanvas.getContext("2d");
const nctx = snowCanvas.getContext("2d");

let DPR = Math.max(1, window.devicePixelRatio || 1);
let W = innerWidth;
let H = innerHeight;

/* Resize para garantir nitidez no iPhone */
function resizeAll(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  W = innerWidth; 
  H = innerHeight;

  [starsCanvas, auroraCanvas, snowCanvas].forEach(c=>{
    c.width  = Math.floor(W * DPR);
    c.height = Math.floor(H * DPR);
    c.style.width  = W + "px";
    c.style.height = H + "px";
  });

  sctx.setTransform(DPR,0,0,DPR,0,0);
  actx.setTransform(DPR,0,0,DPR,0,0);
  nctx.setTransform(DPR,0,0,DPR,0,0);

  initStars();
  initSnow();
}

window.addEventListener("resize", resizeAll);


/* ============================================================
   ESTRELAS
============================================================ */

let stars = [];

function initStars(){
  stars = [];

  const count = Math.max(120, Math.floor((W*H)/8000)); // mais estrelas no iPhone 15
  for(let i=0;i<count;i++){
    stars.push({
      x: Math.random()*W,
      y: Math.random()*H,
      r: Math.random()*1.4 + 0.3,
      alpha: Math.random()*0.8 + 0.2,
      phase: Math.random()*Math.PI*2
    });
  }
}

function drawStars(){
  sctx.clearRect(0,0,W,H);

  for(const st of stars){
    st.phase += 0.01;
    const a = st.alpha * (0.5 + 0.5*Math.sin(st.phase));

    sctx.beginPath();
    sctx.fillStyle = Math.random() > 0.9
      ? `rgba(207,163,224,${a})`
      : `rgba(255,255,255,${a})`;

    sctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
    sctx.fill();
  }

  requestAnimationFrame(drawStars);
}


/* ============================================================
   AURORA M√çSTICA
============================================================ */

let aurPhase = 0;

function drawAurora(){
  actx.clearRect(0,0,W,H);
  aurPhase += 0.0016;

  const gradient = actx.createLinearGradient(0, H*0.1, 0, H*0.4);
  gradient.addColorStop(0,   "rgba(151,88,198,0.16)");
  gradient.addColorStop(0.5, "rgba(233,160,119,0.07)");
  gradient.addColorStop(1,   "rgba(130,80,150,0)");

  actx.fillStyle = gradient;
  actx.beginPath();
  actx.moveTo(0, H*0.30);

  for(let x=0; x<=W; x+=55){
    const y = H*0.28 + Math.sin((x*0.0038)+(aurPhase*3)) * 14;
    actx.lineTo(x, y);
  }

  actx.lineTo(W, H*0.30);
  actx.closePath();
  actx.fill();

  requestAnimationFrame(drawAurora);
}


/* ============================================================
   NEVE LEVE
============================================================ */

let flakes = [];

function initSnow(){
  flakes = [];
  const isMobile = /iPhone|Android/i.test(navigator.userAgent);
  const count = isMobile ? 48 : 90;

  for(let i=0;i<count;i++){
    flakes.push({
      x: Math.random()*W, 
      y: Math.random()*H,
      r: Math.random()*2.5 + 0.6,
      vx: (Math.random()-0.5)*0.3,
      vy: Math.random()*0.6 + 0.15,
      rot: Math.random()*Math.PI*2
    });
  }
}

function drawSnow(){
  nctx.clearRect(0,0,W,H);
  nctx.fillStyle = "rgba(255,255,255,0.9)";

  for(const f of flakes){
    nctx.beginPath();
    nctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
    nctx.fill();

    f.x += f.vx + Math.sin(f.rot)*0.12;
    f.y += f.vy;
    f.rot += 0.008;

    if(f.y > H+10){ f.y = -10; f.x = Math.random()*W; }
    if(f.x < -20){ f.x = W+20; }
    if(f.x > W+20){ f.x = -20; }
  }

  requestAnimationFrame(drawSnow);
}


/* ============================================================
   START EVERYTHING
============================================================ */

resizeAll();
drawStars();
drawAurora();
drawSnow();
</script>
</body>
</html>
